<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-avatar (click)="goToProfile()">
        <img *ngIf="userPhotoUrl" [src]="userPhotoUrl"  />
        <img *ngIf="!userPhotoUrl" src="../../../assets/images/avatar/4.jpg" />
       
        <!--
        <img *ngIf="userPhotoUrl" [src]="userPhotoUrl" alt="User avatar" (error)="handleAvatarError($event)">
        <ion-icon *ngIf="!userPhotoUrl" name="person-circle-outline" class="avatar-icon"></ion-icon>
        -->
      </ion-avatar>
      <div class="user-info">
        <h2>{{ 'COMMON.WELCOME' | translate }}</h2>
        <h3>{{ userName }}!</h3>
      </div>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-button (click)="goToNotifications()">
        <ion-icon name="notifications-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button (click)="goToSettings()">
        <ion-icon name="settings-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Календар -->
  <div class="calendar-strip" (click)="goToCalendar()">
    <div class="week-days">
      <div *ngFor="let day of weekDays" 
           class="day-item" 
           [class.current]="isCurrentDay(day.date)"
           [class.marked]="day.marked">
        <span class="day-name">{{ day.name }}</span>
        <span class="day-number">{{ day.date }}</span>
      </div>
    </div>
  </div>

  <!-- Челендж -->
  <div class="challenge-phase" *ngIf="activeChallenge">
    <div class="phase-circle">
      <h2>{{ 'HOME.CURRENT_CHALLENGE' | translate }}</h2>
      <h1>{{ activeChallenge.title }}</h1>
      <p>{{ 'HOME.DAY_OF' | translate: { current: currentDay, total: totalDays } }}</p>
      
      <!-- Прогрес-бар -->
      <div class="progress-bar">
        <div class="progress" [style.width.%]="(currentDay/totalDays)*100"></div>
      </div>

      <!-- Завдання -->
      <div class="challenge-tasks">
        <div class="task-item" [class.completed]="task.completed" *ngFor="let task of dailyTasks">
          <ion-icon [name]="task.icon" [attr.aria-hidden]="true"></ion-icon>
          <span>{{ task.name }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="no-challenge" *ngIf="!activeChallenge">
    <ion-button expand="block" (click)="goToCurrentChallenge()">
      <ion-icon name="add-outline" slot="start" [attr.aria-hidden]="true"></ion-icon>
      {{ 'HOME.START_CHALLENGE' | translate }}
    </ion-button>
  </div>

  <!-- Статистика -->
  <div class="stats-grid">
    <div class="stat-item" (click)="goToHabit('steps')">
      <ion-icon name="footsteps-outline"></ion-icon>
      <h3>{{ 'HOME.STEPS' | translate }}</h3>
      <h2>{{ stepsCount }}</h2>
      <div class="stats-item">
        <div class="metric-header">
          <img src="assets/icons/empty-set.svg" class="primary" alt="{{ 'EMPTY_SET' | translate }}" />
          <span class="metric-value">{{ averageSteps | number:'1.0-0' }}</span>
        </div>
      </div>
    </div>
    <div class="stat-item" (click)="goToHabit('sleep')">
      <ion-icon name="moon-outline"></ion-icon>
      <h3>{{ 'HOME.SLEEP' | translate }}</h3>
      <h2>{{ sleepHours }}</h2>
      <div class="stats-item">
        <div class="metric-header">
          <img src="assets/icons/empty-set.svg" class="primary" alt="{{ 'EMPTY_SET' | translate }}" />
          <span class="metric-value">{{ averageSleep | number:'1.1-1' }} Hr</span>
        </div>
      </div>
    </div>
    <div class="stat-item" (click)="goToHabit('water')">
      <ion-icon name="water-outline"></ion-icon>
      <h3>{{ 'HOME.WATER' | translate }}</h3>
      <h2>{{ waterAmount }}</h2>
      <div class="stats-item">
        <div class="metric-header">
          <img src="assets/icons/empty-set.svg" class="primary" alt="{{ 'EMPTY_SET' | translate }}" />
          <span class="metric-value">{{ averageWater | number:'1.0-1' }} L</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Щоденні завдання -->
  <ion-list *ngIf="activeChallenge && dailyTasks.length > 0">
    <ion-list-header>
      <ion-label>Щоденні завдання</ion-label>
      <ion-label>{{ 'HOME.DAILY_TASKS' | translate }}</ion-label>
    </ion-list-header>

    <ion-item *ngFor="let task of dailyTasks">
      <ion-icon [name]="task.icon" slot="start" [attr.aria-hidden]="true"></ion-icon>
      <ion-checkbox 
        slot="end"
        [(ngModel)]="task.completed">
        {{ task.name }}
      </ion-checkbox>
    </ion-item>
  </ion-list>

  <!-- Побажання -->
  <ion-card class="wish-card" (click)="showWish()" *ngIf="currentWish">
    <ion-card-content>
      <ion-icon name="heart-outline" [class.unread]="hasUnreadWish"></ion-icon>
      <p>{{ currentWish }}</p>
    </ion-card-content>
  </ion-card>

  <!-- Швидкі дії -->
  <ion-grid>
    <ion-row>
      <ion-col size="6">
        <ion-button expand="block" (click)="goToLifeWheel()" [attr.aria-label]="'Перейти до колеса життя'">
          <ion-icon name="settings-outline" slot="start" [attr.aria-hidden]="true"></ion-icon>
          {{ 'HOME.LIFE_WHEEL' | translate }}
        </ion-button>
      </ion-col>
      <ion-col size="6">
        <ion-button expand="block" (click)="goToCurrentChallenge()" [attr.aria-label]="'Перейти до поточного челенджу'">
          <ion-icon name="calendar-outline" slot="start" [attr.aria-hidden]="true"></ion-icon>
          {{ 'HOME.CHALLENGE' | translate }}
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content> 